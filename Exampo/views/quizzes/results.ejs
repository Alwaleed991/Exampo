<% layout("layouts/boilerplate") %>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/stylesheets/take_quiz.css">

<body>

    <!-- Background animation divs -->
    <div class="bg"></div>
    <div class="bg bg2"></div>
    <div class="bg bg3"></div>

    <div class="quiz-container">
        <!-- Results display -->
        <div class="results">
            <div class="score">
                <h2>Quiz Results</h2>
                <p>Your Score: <%= attempt.score %> / <%= attempt.answers.length %></p>
            </div>
            <div class="review-container">
                <h3>Review Your Answers:</h3>
                <% attempt.answers.forEach((answer, index) => { %>
                    <div class="review-question">
                        <p><strong>Question <%= index + 1 %>:</strong> <%= answer.question.questionText %></p>
                        <p style="color: <%= answer.question.options.find(opt => opt.text === answer.selectedOption && opt.isCorrect) ? '#4caf50' : '#f44336' %>">
                            <% if(answer.selectedOption){ %>
                                Your answer: <%= answer.selectedOption %> 
                            <% }else{ %>
                                Not answered
                            <% } %>

                            <%= answer.question.options.find(opt => opt.text === answer.selectedOption && opt.isCorrect) ? '✓' : '✗' %>
                        </p>
                        <% if (!answer.question.options.find(opt => opt.text === answer.selectedOption && opt.isCorrect)) { %>
                            <p style="color: #4caf50">Correct answer: <%= answer.question.options.find(opt => opt.isCorrect).text %></p>
                        <% } %>
                    </div>
                <% }); %>
            </div>
            
            <a href="/quizzes/<%= attempt.quiz._id %>/take"><button>Restart Quiz</button></a>
            <a href="/home"><button type="button">Finish</button></a>
        </div>
    </div>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</html>
